"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9659],{19659:(e,t,a)=>{a.d(t,{A:()=>o});var r=a(95155),n=a(12115),s=a(98015);function o(e){let{onScanSuccess:t,onScanError:a,isOpen:o,onClose:i}=e,l=(0,n.useRef)(null),[c,d]=(0,n.useState)(!1),[m,u]=(0,n.useState)(null),[x,h]=(0,n.useState)(!1),[b,g]=(0,n.useState)(""),[p,f]=(0,n.useState)(!1),v="qr-scanner-container";(0,n.useEffect)(()=>(!o||p||x?o||(w(),f(!1)):(console.log("QR Scanner opened, auto-starting camera"),y()),()=>{w()}),[o,p,x]);let y=async()=>{var e,a,r,n,o;try{console.log("\uD83D\uDD0D Starting HTML5-QRCode scanner initialization..."),console.log("\uD83D\uDD27 Environment check:",{navigator:!!navigator,mediaDevices:!!(null==(e=navigator)?void 0:e.mediaDevices),getUserMedia:!!(null==(r=navigator)||null==(a=r.mediaDevices)?void 0:a.getUserMedia),userAgent:navigator.userAgent,platform:navigator.platform}),u(null),f(!0),await new Promise(e=>setTimeout(e,100));let n=null,o=0;for(;!n&&o<20;)!(n=document.getElementById(v))&&(console.log("\uD83D\uDD04 Waiting for DOM element (attempt ".concat(o+1,"/").concat(20,")...")),await new Promise(e=>setTimeout(e,200)),o++);if(!n)throw Error("Scanner container not found in DOM after retries");console.log("\uD83D\uDCE6 Scanner container found:",n),l.current=new s.j9(v),console.log("\uD83D\uDCF7 Scanner instance created successfully"),console.log("\uD83C\uDFAF Attempting camera initialization...");try{console.log("\uD83D\uDCF1 Trying back camera first..."),await l.current.start({facingMode:{exact:"environment"}},{fps:10,qrbox:function(e,t){let a=Math.floor(.8*e),r=Math.floor(.15*t);return{width:a,height:r}},aspectRatio:1,videoConstraints:{width:{ideal:1920},height:{ideal:1080},facingMode:{exact:"environment"}}},(e,a)=>{var r,n;console.log("✅ Barcode/QR detected:",e),console.log("\uD83D\uDCCA Scan result:",a),navigator.vibrate&&navigator.vibrate(100),j(),t(e,(null==(n=a.result)||null==(r=n.format)?void 0:r.formatName)||"Unknown"),setTimeout(()=>{N()},100)},e=>{}),d(!0),console.log("\uD83D\uDE80 Back camera started successfully!");return}catch(e){throw console.error("\uD83D\uDCA5 Back camera initialization failed:",e),Error("Back camera required for barcode scanning but failed to initialize: "+e.message)}}catch(e){console.error("❌ Complete scanner initialization failed:",e),console.error("\uD83D\uDD0D Error details:",{name:e.name,message:e.message,stack:e.stack}),"NotAllowedError"===e.name?u("Camera permission denied. Please allow camera access and try again."):"NotFoundError"===e.name?u("No camera found on this device"):(null==(n=e.message)?void 0:n.includes("Permission denied"))?u("Camera permission denied. Please allow camera access."):(null==(o=e.message)?void 0:o.includes("container not found"))?u("Scanner interface not ready. Please try again."):u("Failed to start camera: "+(e.message||"Unknown error. Check console for details."))}},j=async()=>{try{l.current&&c&&(console.log("\uD83D\uDED1 Stopping scanner..."),await l.current.stop(),await l.current.clear(),l.current=null,console.log("✅ Scanner stopped and cleared"))}catch(e){console.error("Error stopping scanner:",e)}},w=async()=>{try{await j(),d(!1),f(!1)}catch(e){console.error("Error cleaning up camera:",e)}},N=()=>{try{w(),i(),u(null),h(!1),g(""),f(!1)}catch(e){console.error("Error closing scanner:",e),i()}};return o?(0,r.jsx)("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm overflow-y-auto h-full w-full z-50 flex items-center justify-center p-4",children:(0,r.jsx)("div",{className:"bg-gray-900 border border-gray-700 rounded-xl shadow-2xl max-w-md w-full mx-4",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-brand-primary-text",children:m?"Camera Error":x?"Enter Barcode":"Scan Barcode"}),(0,r.jsx)("button",{onClick:N,className:"text-gray-400 hover:text-gray-200 transition-colors p-1 rounded-lg hover:bg-gray-700/50 active:scale-95 touch-manipulation",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsx)("div",{className:"mb-4",children:x?(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),b.trim()&&(t(b.trim(),"Manual"),N())},className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"manual-input",className:"block text-sm font-medium text-brand-primary-text mb-2",children:"Enter barcode or asset ID:"}),(0,r.jsx)("input",{id:"manual-input",type:"text",value:b,onChange:e=>g(e.target.value),placeholder:"Type or paste the barcode here...",className:"w-full px-3 py-2 border border-gray-600 rounded-lg bg-gray-800 text-brand-primary-text focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0})]}),(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsx)("button",{type:"submit",disabled:!b.trim(),className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white rounded-lg text-sm font-medium active:scale-95 touch-manipulation transition-all",children:"Submit"}),(0,r.jsx)("button",{type:"button",onClick:()=>h(!1),className:"px-4 py-2 border border-gray-600 rounded-lg text-sm font-medium text-gray-300 hover:bg-gray-700/50 active:scale-95 touch-manipulation transition-all",children:"Camera"})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"border border-gray-600 rounded-lg overflow-hidden bg-black min-h-[500px] flex items-center justify-center relative",children:[(0,r.jsx)("div",{id:v,className:"w-full h-full absolute inset-0",style:{minHeight:"500px",width:"100%",height:"100%"}}),c&&!m&&(0,r.jsx)("div",{className:"absolute inset-0 pointer-events-none flex items-center justify-center z-20",children:(0,r.jsxs)("div",{className:"relative",style:{width:"80%",height:"15%",maxWidth:"600px"},children:[(0,r.jsx)("div",{className:"absolute inset-0 border-2 border-red-500 rounded-sm shadow-[0_0_15px_rgba(239,68,68,0.6)]"}),(0,r.jsx)("div",{className:"absolute left-0 right-0 h-0.5 bg-gradient-to-r from-transparent via-red-500 to-transparent shadow-[0_0_10px_rgba(239,68,68,0.8)]",style:{top:"50%"}}),(0,r.jsx)("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 w-4 h-4 border-l-2 border-t-2 border-b-2 border-red-500"}),(0,r.jsx)("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 w-4 h-4 border-r-2 border-t-2 border-b-2 border-red-500"})]})}),m&&(0,r.jsx)("div",{className:"absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-10",children:(0,r.jsxs)("div",{className:"bg-red-500/20 border border-red-500/30 rounded-lg p-4 text-center max-w-sm",children:[(0,r.jsx)("div",{className:"flex justify-center mb-3",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,r.jsx)("p",{className:"text-sm text-red-200 mb-3",children:m}),(0,r.jsxs)("div",{className:"space-x-3",children:[(0,r.jsx)("button",{onClick:y,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium active:scale-95 touch-manipulation transition-all",children:"Try Again"}),(0,r.jsx)("button",{onClick:()=>h(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium active:scale-95 touch-manipulation transition-all",children:"Manual"})]})]})}),!c&&!m&&!x&&(0,r.jsx)("div",{className:"absolute inset-0 bg-black/80 flex items-center justify-center z-10",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-orange mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-white text-base font-medium",children:"Starting camera..."}),(0,r.jsx)("p",{className:"text-white/80 text-sm mt-2",children:"Please allow camera permissions"})]})})]}),c&&(0,r.jsxs)("div",{className:"text-sm text-brand-secondary-text text-center space-y-2 mt-4",children:[(0,r.jsx)("p",{className:"font-medium text-brand-primary-text",children:"Align the barcode with the red horizontal box"}),(0,r.jsx)("p",{className:"text-xs opacity-80",children:"Tip: When barcodes are stacked, position only ONE barcode inside the scanning box"})]})]})}),(0,r.jsxs)("div",{className:"flex justify-center space-x-3 mt-6",children:[!m&&!x&&(0,r.jsx)("button",{onClick:()=>h(!0),className:"px-4 py-2 border border-gray-600 rounded-lg text-sm font-medium text-gray-300 hover:bg-gray-700/50 transition-colors active:scale-95 touch-manipulation",children:"Enter Manually"}),(0,r.jsx)("button",{onClick:N,className:"px-6 py-2 border border-gray-600 rounded-lg text-sm font-medium text-gray-300 hover:bg-gray-700/50 transition-colors active:scale-95 touch-manipulation",children:"Cancel"})]})]})})}):null}}}]);