(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7177],{30347:()=>{},60881:(e,t,s)=>{"use strict";s.d(t,{Providers:()=>o});var a=s(95155),r=s(12108),n=s(62432),i=s(71426);function o(e){let{children:t}=e;return(0,a.jsx)(r.SessionProvider,{children:(0,a.jsx)(i.N,{children:(0,a.jsx)(n.e,{children:t})})})}},62432:(e,t,s)=>{"use strict";s.d(t,{_:()=>u,e:()=>d});var a=s(95155),r=s(12115),n=s(12108);let i=(0,r.createContext)(void 0),o="asset-cart";function l(e,t){switch(t.type){case"ADD_ITEM":let s=e.items.findIndex(e=>e.assetId===t.payload.assetId);if(s>=0){let a=[...e.items];return a[s]={...t.payload,addedAt:new Date().toISOString()},{...e,items:a}}return{...e,items:[...e.items,{...t.payload,addedAt:new Date().toISOString()}]};case"REMOVE_ITEM":return{...e,items:e.items.filter(e=>e.assetId!==t.payload.assetId)};case"UPDATE_ITEM":return{...e,items:e.items.map(e=>e.assetId===t.payload.assetId?{...e,...t.payload.updates}:e)};case"CLEAR_CART":return{...e,items:[],lastProcessedAt:new Date().toISOString()};case"SET_PROCESSING":return{...e,isProcessing:t.payload.isProcessing};case"LOAD_FROM_STORAGE":return t.payload;default:return e}}let c={items:[],isProcessing:!1};function d(e){let{children:t}=e,[s,d]=(0,r.useReducer)(l,c),{data:u}=(0,n.useSession)();(0,r.useEffect)(()=>{try{let t=localStorage.getItem(o);if(t){var e;let s=JSON.parse(t),a=(null==(e=s.items)?void 0:e.filter(e=>{let t=new Date(e.addedAt);return(new Date().getTime()-t.getTime())/36e5<24}))||[];d({type:"LOAD_FROM_STORAGE",payload:{...s,items:a,isProcessing:!1}})}}catch(e){console.error("Failed to load cart from storage:",e)}},[]),(0,r.useEffect)(()=>{try{localStorage.setItem(o,JSON.stringify(s))}catch(e){console.error("Failed to save cart to storage:",e)}},[s]);let m=(0,r.useCallback)((e,t)=>{let a=s.items.find(t=>t.assetId===e.id);if(a&&a.action===t)return{canAdd:!1,reason:"Asset is already in cart for ".concat(t.toLowerCase().replace("_"," "))};if("CHECK_OUT"===t){if("AVAILABLE"!==e.status)return{canAdd:!1,reason:"Asset is ".concat(e.status.toLowerCase().replace("_"," ")," and cannot be checked out")}}else if("CHECK_IN"===t&&"CHECKED_OUT"!==e.status)return{canAdd:!1,reason:"Asset is ".concat(e.status.toLowerCase().replace("_"," ")," and cannot be checked in")};return{canAdd:!0}},[s.items]),f=(0,r.useCallback)((e,t)=>{let s=m(e,t);if(!s.canAdd)return console.warn("Cannot add item to cart:",s.reason),!1;let a={assetId:e.id,asset:e,action:t};return"CHECK_OUT"===t&&(null==u?void 0:u.user)&&(a.assignedUserId=u.user.id,a.assignedUserName=u.user.name||u.user.email||"Current User"),d({type:"ADD_ITEM",payload:a}),!0},[m,u]),C=(0,r.useCallback)(e=>{d({type:"REMOVE_ITEM",payload:{assetId:e}})},[]),p=(0,r.useCallback)((e,t)=>{d({type:"UPDATE_ITEM",payload:{assetId:e,updates:t}})},[]),h=(0,r.useCallback)(()=>{d({type:"CLEAR_CART"})},[]),E=(0,r.useCallback)(async()=>{if(0===s.items.length)return{success:!1,errors:["Cart is empty"]};d({type:"SET_PROCESSING",payload:{isProcessing:!0}});try{var e,t;let a=s.items.filter(e=>"CHECK_IN"===e.action),r=s.items.filter(e=>"CHECK_OUT"===e.action),n=[],i=0;if(a.length>0)try{let t=await fetch("/api/transactions/bulk",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"CHECK_IN",items:a.map(e=>({assetId:e.assetId,notes:e.notes}))})});if(t.ok){let s=await t.json();i+=s.processed||0,(null==(e=s.errors)?void 0:e.length)>0&&n.push(...s.errors)}else{let e=await t.json();n.push("Check-in failed: ".concat(e.error))}}catch(e){n.push("Check-in error: ".concat(e.message))}if(r.length>0)try{let e=await fetch("/api/transactions/bulk",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"CHECK_OUT",items:r.map(e=>({assetId:e.assetId,notes:e.notes,expectedReturnDate:e.expectedReturnDate,assignedUserId:e.assignedUserId}))})});if(e.ok){let s=await e.json();i+=s.processed||0,(null==(t=s.errors)?void 0:t.length)>0&&n.push(...s.errors)}else{let t=await e.json();n.push("Check-out failed: ".concat(t.error))}}catch(e){n.push("Check-out error: ".concat(e.message))}let o=i>0;return o&&0===n.length&&h(),{success:o,errors:n}}catch(e){return console.error("Cart processing error:",e),{success:!1,errors:["Failed to process cart"]}}finally{d({type:"SET_PROCESSING",payload:{isProcessing:!1}})}},[s.items,h]),g=(0,r.useCallback)(()=>s.items.length,[s.items]),y=(0,r.useCallback)(e=>s.items.some(t=>t.assetId===e),[s.items]),I=(0,r.useCallback)(()=>s.items.filter(e=>"CHECK_IN"===e.action),[s.items]),_=(0,r.useCallback)(()=>s.items.filter(e=>"CHECK_OUT"===e.action),[s.items]);return(0,a.jsx)(i.Provider,{value:{state:s,addItem:f,removeItem:C,updateItem:p,clearCart:h,processCart:E,getItemCount:g,hasItem:y,getCheckInItems:I,getCheckOutItems:_,canAddItem:m},children:t})}function u(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e}},71426:(e,t,s)=>{"use strict";s.d(t,{D:()=>o,N:()=>i});var a=s(95155),r=s(12115);let n=(0,r.createContext)(void 0);function i(e){let{children:t}=e,[s,i]=(0,r.useState)("dark"),[o,l]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{l(!0);let e=localStorage.getItem("theme");e?i(e):i("dark")},[]),(0,r.useEffect)(()=>{"dark"===s?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("theme",s)},[s]),o)?(0,a.jsx)(n.Provider,{value:{theme:s,toggleTheme:()=>{i(e=>"dark"===e?"light":"dark")}},children:t}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50/30 via-slate-50 to-indigo-50/20 dark:from-brand-dark-blue dark:via-gray-925 dark:to-brand-black flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-orange"})})}function o(){let e=(0,r.useContext)(n);if(!e)throw Error("useTheme must be used within a ThemeProvider");return e}},78346:e=>{e.exports={style:{fontFamily:"'Inter', 'Inter Fallback'",fontStyle:"normal"},className:"__className_f367f3"}},80088:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,78346,23)),Promise.resolve().then(s.t.bind(s,30347,23)),Promise.resolve().then(s.bind(s,60881))}},e=>{e.O(0,[3838,2108,8441,5964,7358],()=>e(e.s=80088)),_N_E=e.O()}]);