"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6438],{19659:(e,t,a)=>{a.d(t,{A:()=>o});var r=a(95155),s=a(12115),n=a(98015);function o(e){let{onScanSuccess:t,onScanError:a,isOpen:o,onClose:i}=e,l=(0,s.useRef)(null),[c,d]=(0,s.useState)(!1),[u,m]=(0,s.useState)(null),[g,h]=(0,s.useState)(!1),[p,x]=(0,s.useState)(""),[b,y]=(0,s.useState)(!1),f="qr-scanner-container";(0,s.useEffect)(()=>(!o||b||g?o||(C(),y(!1)):(console.log("QR Scanner opened, auto-starting camera"),v()),()=>{C()}),[o,b,g]);let v=async()=>{var e,a,r,s,o;try{console.log("\uD83D\uDD0D Starting HTML5-QRCode scanner initialization..."),console.log("\uD83D\uDD27 Environment check:",{navigator:!!navigator,mediaDevices:!!(null==(e=navigator)?void 0:e.mediaDevices),getUserMedia:!!(null==(r=navigator)||null==(a=r.mediaDevices)?void 0:a.getUserMedia),userAgent:navigator.userAgent,platform:navigator.platform}),m(null),y(!0),await new Promise(e=>setTimeout(e,100));let s=null,o=0;for(;!s&&o<20;)!(s=document.getElementById(f))&&(console.log("\uD83D\uDD04 Waiting for DOM element (attempt ".concat(o+1,"/").concat(20,")...")),await new Promise(e=>setTimeout(e,200)),o++);if(!s)throw Error("Scanner container not found in DOM after retries");console.log("\uD83D\uDCE6 Scanner container found:",s),l.current=new n.j9(f),console.log("\uD83D\uDCF7 Scanner instance created successfully"),console.log("\uD83C\uDFAF Attempting camera initialization...");try{console.log("\uD83D\uDCF1 Trying back camera first..."),await l.current.start({facingMode:{exact:"environment"}},{fps:10,qrbox:function(e,t){let a=Math.min(e,t),r=Math.floor(.7*a);return{width:r,height:r}},aspectRatio:1,videoConstraints:{width:{ideal:1280},height:{ideal:720},facingMode:{exact:"environment"}}},(e,a)=>{var r,s;console.log("✅ Barcode/QR detected:",e),console.log("\uD83D\uDCCA Scan result:",a),navigator.vibrate&&navigator.vibrate(100),k(),t(e,(null==(s=a.result)||null==(r=s.format)?void 0:r.formatName)||"Unknown"),setTimeout(()=>{w()},100)},e=>{}),d(!0),console.log("\uD83D\uDE80 Back camera started successfully!");return}catch(e){throw console.error("\uD83D\uDCA5 Back camera initialization failed:",e),Error("Back camera required for barcode scanning but failed to initialize: "+e.message)}}catch(e){console.error("❌ Complete scanner initialization failed:",e),console.error("\uD83D\uDD0D Error details:",{name:e.name,message:e.message,stack:e.stack}),"NotAllowedError"===e.name?m("Camera permission denied. Please allow camera access and try again."):"NotFoundError"===e.name?m("No camera found on this device"):(null==(s=e.message)?void 0:s.includes("Permission denied"))?m("Camera permission denied. Please allow camera access."):(null==(o=e.message)?void 0:o.includes("container not found"))?m("Scanner interface not ready. Please try again."):m("Failed to start camera: "+(e.message||"Unknown error. Check console for details."))}},k=async()=>{try{l.current&&c&&(console.log("\uD83D\uDED1 Stopping scanner..."),await l.current.stop(),await l.current.clear(),l.current=null,console.log("✅ Scanner stopped and cleared"))}catch(e){console.error("Error stopping scanner:",e)}},C=async()=>{try{await k(),d(!1),y(!1)}catch(e){console.error("Error cleaning up camera:",e)}},w=()=>{try{C(),i(),m(null),h(!1),x(""),y(!1)}catch(e){console.error("Error closing scanner:",e),i()}};return o?(0,r.jsx)("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm overflow-y-auto h-full w-full z-50 flex items-center justify-center p-4",children:(0,r.jsx)("div",{className:"bg-white dark:bg-brand-dark-blue/95 backdrop-blur-sm border border-gray-200 dark:border-gray-700 rounded-xl shadow-2xl max-w-md w-full mx-4",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-brand-primary-text",children:u?"Camera Error":g?"Enter Barcode":"Scan Barcode"}),(0,r.jsx)("button",{onClick:w,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors p-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700/50 active:scale-95 touch-manipulation",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsx)("div",{className:"mb-4",children:g?(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),p.trim()&&(t(p.trim(),"Manual"),w())},className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"manual-input",className:"block text-sm font-medium text-gray-900 dark:text-brand-primary-text mb-2",children:"Enter barcode or asset ID:"}),(0,r.jsx)("input",{id:"manual-input",type:"text",value:p,onChange:e=>x(e.target.value),placeholder:"Type or paste the barcode here...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-brand-primary-text focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0})]}),(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsx)("button",{type:"submit",disabled:!p.trim(),className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white rounded-lg text-sm font-medium active:scale-95 touch-manipulation transition-all",children:"Submit"}),(0,r.jsx)("button",{type:"button",onClick:()=>h(!1),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700/50 active:scale-95 touch-manipulation transition-all",children:"Camera"})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"border border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden bg-black min-h-[500px] flex items-center justify-center relative",children:[(0,r.jsx)("div",{id:f,className:"w-full h-full absolute inset-0",style:{minHeight:"500px",width:"100%",height:"100%"}}),u&&(0,r.jsx)("div",{className:"absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-10",children:(0,r.jsxs)("div",{className:"bg-red-50 dark:bg-red-900/90 border border-red-200 dark:border-red-800 rounded-lg p-4 text-center max-w-sm",children:[(0,r.jsx)("div",{className:"flex justify-center mb-3",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,r.jsx)("p",{className:"text-sm text-red-800 dark:text-red-200 mb-3",children:u}),(0,r.jsxs)("div",{className:"space-x-3",children:[(0,r.jsx)("button",{onClick:v,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium active:scale-95 touch-manipulation transition-all",children:"Try Again"}),(0,r.jsx)("button",{onClick:()=>h(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium active:scale-95 touch-manipulation transition-all",children:"Manual"})]})]})}),!c&&!u&&!g&&(0,r.jsx)("div",{className:"absolute inset-0 bg-black/80 flex items-center justify-center z-10",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-orange mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-white text-base font-medium",children:"Starting camera..."}),(0,r.jsx)("p",{className:"text-white/80 text-sm mt-2",children:"Please allow camera permissions"})]})})]}),c&&(0,r.jsxs)("div",{className:"text-sm text-gray-600 dark:text-brand-secondary-text text-center space-y-2 mt-4",children:[(0,r.jsx)("p",{className:"font-medium text-gray-900 dark:text-brand-primary-text",children:"Position the barcode or QR code in front of the camera"}),(0,r.jsx)("p",{className:"text-xs opacity-80",children:"You can also enter the code manually if scanning doesn't work"})]})]})}),(0,r.jsxs)("div",{className:"flex justify-center space-x-3 mt-6",children:[!u&&!g&&(0,r.jsx)("button",{onClick:()=>h(!0),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors active:scale-95 touch-manipulation",children:"Enter Manually"}),(0,r.jsx)("button",{onClick:w,className:"px-6 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors active:scale-95 touch-manipulation",children:"Cancel"})]})]})})}):null}},62432:(e,t,a)=>{a.d(t,{_:()=>u,e:()=>d});var r=a(95155),s=a(12115),n=a(12108);let o=(0,s.createContext)(void 0),i="asset-cart";function l(e,t){switch(t.type){case"ADD_ITEM":let a=e.items.findIndex(e=>e.assetId===t.payload.assetId);if(a>=0){let r=[...e.items];return r[a]={...t.payload,addedAt:new Date().toISOString()},{...e,items:r}}return{...e,items:[...e.items,{...t.payload,addedAt:new Date().toISOString()}]};case"REMOVE_ITEM":return{...e,items:e.items.filter(e=>e.assetId!==t.payload.assetId)};case"UPDATE_ITEM":return{...e,items:e.items.map(e=>e.assetId===t.payload.assetId?{...e,...t.payload.updates}:e)};case"CLEAR_CART":return{...e,items:[],lastProcessedAt:new Date().toISOString()};case"SET_PROCESSING":return{...e,isProcessing:t.payload.isProcessing};case"LOAD_FROM_STORAGE":return t.payload;default:return e}}let c={items:[],isProcessing:!1};function d(e){let{children:t}=e,[a,d]=(0,s.useReducer)(l,c),{data:u}=(0,n.useSession)();(0,s.useEffect)(()=>{try{let t=localStorage.getItem(i);if(t){var e;let a=JSON.parse(t),r=(null==(e=a.items)?void 0:e.filter(e=>{let t=new Date(e.addedAt);return(new Date().getTime()-t.getTime())/36e5<24}))||[];d({type:"LOAD_FROM_STORAGE",payload:{...a,items:r,isProcessing:!1}})}}catch(e){console.error("Failed to load cart from storage:",e)}},[]),(0,s.useEffect)(()=>{try{localStorage.setItem(i,JSON.stringify(a))}catch(e){console.error("Failed to save cart to storage:",e)}},[a]);let m=(0,s.useCallback)((e,t)=>{let r=a.items.find(t=>t.assetId===e.id);if(r&&r.action===t)return{canAdd:!1,reason:"Asset is already in cart for ".concat(t.toLowerCase().replace("_"," "))};if("CHECK_OUT"===t){if("AVAILABLE"!==e.status)return{canAdd:!1,reason:"Asset is ".concat(e.status.toLowerCase().replace("_"," ")," and cannot be checked out")}}else if("CHECK_IN"===t&&"CHECKED_OUT"!==e.status)return{canAdd:!1,reason:"Asset is ".concat(e.status.toLowerCase().replace("_"," ")," and cannot be checked in")};return{canAdd:!0}},[a.items]),g=(0,s.useCallback)((e,t)=>{let a=m(e,t);if(!a.canAdd)return console.warn("Cannot add item to cart:",a.reason),!1;let r={assetId:e.id,asset:e,action:t};return"CHECK_OUT"===t&&(null==u?void 0:u.user)&&(r.assignedUserId=u.user.id,r.assignedUserName=u.user.name||u.user.email||"Current User"),d({type:"ADD_ITEM",payload:r}),!0},[m,u]),h=(0,s.useCallback)(e=>{d({type:"REMOVE_ITEM",payload:{assetId:e}})},[]),p=(0,s.useCallback)((e,t)=>{d({type:"UPDATE_ITEM",payload:{assetId:e,updates:t}})},[]),x=(0,s.useCallback)(()=>{d({type:"CLEAR_CART"})},[]),b=(0,s.useCallback)(async()=>{if(0===a.items.length)return{success:!1,errors:["Cart is empty"]};d({type:"SET_PROCESSING",payload:{isProcessing:!0}});try{var e,t;let r=a.items.filter(e=>"CHECK_IN"===e.action),s=a.items.filter(e=>"CHECK_OUT"===e.action),n=[],o=0;if(r.length>0)try{let t=await fetch("/api/transactions/bulk",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"CHECK_IN",items:r.map(e=>({assetId:e.assetId,notes:e.notes}))})});if(t.ok){let a=await t.json();o+=a.processed||0,(null==(e=a.errors)?void 0:e.length)>0&&n.push(...a.errors)}else{let e=await t.json();n.push("Check-in failed: ".concat(e.error))}}catch(e){n.push("Check-in error: ".concat(e.message))}if(s.length>0)try{let e=await fetch("/api/transactions/bulk",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"CHECK_OUT",items:s.map(e=>({assetId:e.assetId,notes:e.notes,expectedReturnDate:e.expectedReturnDate,assignedUserId:e.assignedUserId}))})});if(e.ok){let a=await e.json();o+=a.processed||0,(null==(t=a.errors)?void 0:t.length)>0&&n.push(...a.errors)}else{let t=await e.json();n.push("Check-out failed: ".concat(t.error))}}catch(e){n.push("Check-out error: ".concat(e.message))}let i=o>0;return i&&0===n.length&&x(),{success:i,errors:n}}catch(e){return console.error("Cart processing error:",e),{success:!1,errors:["Failed to process cart"]}}finally{d({type:"SET_PROCESSING",payload:{isProcessing:!1}})}},[a.items,x]),y=(0,s.useCallback)(()=>a.items.length,[a.items]),f=(0,s.useCallback)(e=>a.items.some(t=>t.assetId===e),[a.items]),v=(0,s.useCallback)(()=>a.items.filter(e=>"CHECK_IN"===e.action),[a.items]),k=(0,s.useCallback)(()=>a.items.filter(e=>"CHECK_OUT"===e.action),[a.items]);return(0,r.jsx)(o.Provider,{value:{state:a,addItem:g,removeItem:h,updateItem:p,clearCart:x,processCart:b,getItemCount:y,hasItem:f,getCheckInItems:v,getCheckOutItems:k,canAddItem:m},children:t})}function u(){let e=(0,s.useContext)(o);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e}}}]);